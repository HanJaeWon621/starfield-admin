(function($,window,document,undefined){var docHead=document.getElementsByTagName("head")[0];var bmStyle=document.createElement("style");bmStyle.setAttribute("type","text/css");bmStyle.setAttribute("id","BeemapIndoorStyle");bmStyle.setAttribute("media","all");bmStyle.innerHTML='body,html{padding:0;margin:0;height:100%}#beemap-indoor-container{position:fixed;background:#0d0d0d;width:100%;height:100%;top:0;left:0;display:none;z-index:1000}.beemap-indoor-container{overflow:hidden}.beemap-indoor-close{width:32px;height:32px;position:absolute;right:20px;top:20px;cursor:pointer;text-align:center;overflow:hidden;text-shadow:0 0 3px #6d6d6d;-webkit-transition:all ease .2s;-moz-transition:all ease .2s;-o-transition:all ease .2s;transition:all ease .2s}.beemap-indoor-close:after,.beemap-indoor-close:before{content:"";height:4px;width:32px;background:#FFF;position:absolute;left:0;top:50%;margin-top:-2px}.beemap-indoor-close:before{-webkit-transform:rotate(45deg);-moz-transform:rotate(45deg);-ms-transform:rotate(45deg);-o-transform:rotate(45deg);transform:rotate(45deg)}.beemap-indoor-close:after{-webkit-transform:rotate(-45deg);-moz-transform:rotate(-45deg);-ms-transform:rotate(-45deg);-o-transform:rotate(-45deg);transform:rotate(-45deg)}.beemap-indoor-close:hover{-webkit-transform:rotate(90deg);-moz-transform:rotate(90deg);-ms-transform:rotate(90deg);-o-transform:rotate(90deg);transform:rotate(90deg)}.beemap-indoor-snap-view{width:150px;height:150px;position:absolute;top:20px;left:20px;border:1px solid #666;background:#000;z-index:100;-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;-webkit-transition:all ease .4s;-moz-transition:all ease .4s;-o-transition:all ease .4s;transition:all ease .4s;opacity:0}.beemap-indoor-snap-image-wrap{display:inline-block;position:absolute;max-width:150px;max-height:150px;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);-moz-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);-o-transform:translate(-50%,-50%);transform:translate(-50%,-50%);overflow:hidden}.beemap-indoor-snap-image{position:relative}.beemap-indoor-snap-handle{position:absolute;border:1px solid #ccc;-webkit-transform:translate3d(0,0,0);-moz-transform:translate3d(0,0,0);-ms-transform:translate3d(0,0,0);-o-transform:translate3d(0,0,0);transform:translate3d(0,0,0);-webkit-box-shadow:0 0 0 200px rgba(0,0,0,.5);-moz-box-shadow:0 0 0 200px rgba(0,0,0,.5);box-shadow:0 0 0 200px rgba(0,0,0,.5)}.beemap-indoor-zoom-slider{width:100%;-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;border:1px solid #666;border-top:0;background:rgba(204,204,204,.1);height:15px;position:absolute;top:150px;left:-1px}.beemap-indoor-topleft{position:absolute;top:10px;left:10px}.beemap-indoor-topright{position:absolute;top:10px;right:10px}.beemap-indoor-bottomleft{position:absolute;bottom:10px;left:10px}.beemap-indoor-bottomright{position:absolute;bottom:10px;right:10px}.beemap-indoor-floor-controler .floor-list{list-style-type:none;margin:0;padding:0}.beemap-indoor-floor-controler .floor-list li{margin:1px;padding:6px 10px 7px;font-weight:700;font-size:1.1em;color:#444;background-color:#fff;border:1px solid #ddd;cursor:pointer}.beemap-indoor-zoom-controler button,.beemap-indoor-zoom-controler button:hover{background-color:#fff;border:0;width:26px;height:26px;display:block;text-align:center;text-decoration:none;color:#000;padding:0;margin:0;-webkit-border-radius:4px;border-radius:4px}.beemap-indoor-zoom-controler button{background-position:50% 50%;background-repeat:no-repeat;display:block;cursor:pointer;border:1px solid #ccc}.beemap-indoor-zoom-controler button:hover{background-color:#f4f4f4}.beemap-indoor-zoom-controler button.beemap-indoor-disabled{cursor:default;background-color:#f4f4f4;color:#bbb}.beemap-indoor-zoom-controler-in{font:700 18px Monaco,monospace}.beemap-indoor-zoom-controler-out{font:700 20px Monaco,monospace}.beemap-indoor-zoom-handle{width:20px;height:15px;background:#ccc;position:absolute}.beemap-indoor-marker-layer{position:absolute;top:0;left:0;right:0;bottom:0;z-index:2}.beemap-indoor-draw-layer{position:absolute;top:0;left:0;right:0;bottom:0;width:100%;height:100%;z-index:-1}.beemap-indoor-marker{position:absolute;width:1px;height:30px}.beemap-indoor-image-view{position:absolute;height:100%;width:100%}.beemap-indoor-image-wrap{display:inline-block}.beemap-indoor-image-wrap:active{cursor:move}.beemap-indoor-large-image{max-width:100%;max-height:100%;position:absolute;-webkit-transform:translate3d(0,0,0);-moz-transform:translate3d(0,0,0);-ms-transform:translate3d(0,0,0);-o-transform:translate3d(0,0,0);transform:translate3d(0,0,0)}.beemap-indoor-loader{top:50%;left:50%;border-radius:50%;width:32px;height:32px;z-index:100;margin-top:-16px;margin-left:-16px;font-size:5px;position:absolute;text-indent:-9999em;border-top:1.1em solid rgba(255,255,255,.2);border-right:1.1em solid rgba(255,255,255,.2);border-bottom:1.1em solid rgba(255,255,255,.2);border-left:1.1em solid #fff;-webkit-transform:translateZ(0);-ms-transform:translateZ(0);transform:translateZ(0);-webkit-animation:load8 1.1s infinite linear;animation:load8 1.1s infinite linear}.beemap-indoor-loader:after{width:10em;height:10em;border-radius:50%}@-webkit-keyframes load8{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes load8{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@media screen and (max-width:767px){.beemap-indoor-snap-view{z-index:-1;visibility:hidden}.beemap-indoor-floor-controler .floor-list li{margin:2px;padding:8px 14px 9px;font-weight:700;font-size:1.3em;color:#444;background-color:#fff;border:2px solid #ddd;cursor:pointer}.beemap-indoor-zoom-controler button,.beemap-indoor-zoom-controler button:hover{background-color:#fff;border:0;width:46px;height:46px;display:block;text-align:center;text-decoration:none;color:#000;padding:0;margin:0;-webkit-border-radius:7px;border-radius:7px}.beemap-indoor-zoom-controler button{background-position:50% 50%;background-repeat:no-repeat;display:block;cursor:pointer;border:2px solid #ccc}.beemap-indoor-zoom-controler button:hover{background-color:#f4f4f4}.beemap-indoor-zoom-controler button.beemap-indoor-disabled{cursor:default;background-color:#f4f4f4;color:#bbb}.beemap-indoor-zoom-controler-in{font:700 22px Monaco,monospace}.beemap-indoor-zoom-controler-out{font:700 24px Monaco,monospace}}';
docHead.appendChild(bmStyle);var noop=function(){};var $body=$("body"),$window=$(window),$document=$(document);var ZOOM_CONSTANT=15;var MOUSE_WHEEL_COUNT=5;var GMID=1;var GMID_PREFIX="beemap-indoor-marker-mid";var GMARKERS=[];function easeOutQuart(t,b,c,d){t/=d;t--;return-c*(t*t*t*t-1)+b}(function(){var lastTime=0;var vendors=["ms","moz","webkit","o"];for(var x=0;x<vendors.length&&!window.requestAnimationFrame;++x){window.requestAnimationFrame=window[vendors[x]+"RequestAnimationFrame"];window.cancelAnimationFrame=
window[vendors[x]+"CancelAnimationFrame"]||window[vendors[x]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame)window.requestAnimationFrame=function(callback,element){var currTime=(new Date).getTime();var timeToCall=Math.max(0,16-(currTime-lastTime));var id=window.setTimeout(function(){callback(currTime+timeToCall)},timeToCall);lastTime=currTime+timeToCall;return id};if(!window.cancelAnimationFrame)window.cancelAnimationFrame=function(id){clearTimeout(id)}})();function imageLoaded(img){return img.complete&&
(typeof img.naturalWidth==="undefined"||img.naturalWidth!==0)}var imageViewHtml=['\x3cdiv class\x3d"beemap-indoor-loader"\x3e\x3c/div\x3e','\x3cdiv class\x3d"beemap-indoor-snap-view"\x3e','\t\x3cdiv class\x3d"beemap-indoor-snap-image-wrap"\x3e','\t\t\x3cdiv class\x3d"beemap-indoor-snap-handle"\x3e\x3c/div\x3e',"\t\x3c/div\x3e",'\t\x3cdiv class\x3d"beemap-indoor-zoom-slider"\x3e','\t\t\x3cdiv class\x3d"beemap-indoor-zoom-handle"\x3e\x3c/div\x3e',"\t\x3c/div\x3e","\x3c/div\x3e",'\x3cdiv class\x3d"beemap-indoor-image-view" \x3e',
'\t\x3cdiv class\x3d"beemap-indoor-image-wrap" \x3e\x3c/div\x3e',"\x3c/div\x3e",'\x3cdiv class\x3d"beemap-indoor-topleft"\x3e\x3c/div\x3e','\x3cdiv class\x3d"beemap-indoor-topright"\x3e\x3c/div\x3e','\x3cdiv class\x3d"beemap-indoor-bottomleft"\x3e\x3c/div\x3e','\x3cdiv class\x3d"beemap-indoor-bottomright"\x3e\x3c/div\x3e'].join("");function ImageViewer(container,options){var self=this;self.container=container;options=self.options=$.extend({},ImageViewer.defaults,options);self.zoomValue=100;if(!container.find(".snap-view").length)container.prepend(imageViewHtml);
container.addClass("beemap-indoor-container");if(container.css("position")=="static")container.css("position","relative");self.snapView=container.find(".beemap-indoor-snap-view");self.snapImageWrap=container.find(".beemap-indoor-snap-image-wrap");self.imageWrap=container.find(".beemap-indoor-image-wrap");self.snapHandle=container.find(".beemap-indoor-snap-handle");self.zoomHandle=container.find(".beemap-indoor-zoom-handle");self.controltl=container.find(".beemap-indoor-topleft");self.controltr=container.find(".beemap-indoor-topright");
self.controlbl=container.find(".beemap-indoor-bottomleft");self.controlbr=container.find(".beemap-indoor-bottomright");self._viewerId="beemap-indoor"+Math.floor(Math.random()*1E6)}function Slider(container,options){this.container=container;this.onStart=options.onStart||noop;this.onMove=options.onMove||noop;this.onEnd=options.onEnd||noop;this.sliderId=options.sliderId||"slider"+Math.ceil(Math.random()*1E6)}Slider.prototype.init=function(){var self=this,container=this.container,eventSuffix="."+this.sliderId;
this.container.on("touchstart"+eventSuffix+" mousedown"+eventSuffix,function(estart){estart.preventDefault();var touchMove=(estart.type=="touchstart"?"touchmove":"mousemove")+eventSuffix,touchEnd=(estart.type=="touchstart"?"touchend":"mouseup")+eventSuffix,eOrginal=estart.originalEvent,sx=eOrginal.clientX||eOrginal.touches[0].clientX,sy=eOrginal.clientY||eOrginal.touches[0].clientY;var start=self.onStart(estart,{x:sx,y:sy});if(start===false)return;var moveListener=function(emove){emove.preventDefault();
eOrginal=emove.originalEvent;var mx=eOrginal.clientX||eOrginal.touches[0].clientX,my=eOrginal.clientY||eOrginal.touches[0].clientY;self.onMove(emove,{dx:mx-sx,dy:my-sy,mx:mx,my:my})};var endListener=function(){$document.off(touchMove,moveListener);$document.off(touchEnd,endListener);self.onEnd()};$document.on(touchMove,moveListener);$document.on(touchEnd,endListener)});return this};ImageViewer.prototype={constructor:ImageViewer,_init:function(){var viewer=this,options=viewer.options,zooming=false,
container=this.container;var eventSuffix="."+viewer._viewerId;var snapHandle=this.snapHandle;var snapImgWrap=this.snapImageWrap;var imageWrap=this.imageWrap;var snapSlider=(new Slider(snapImgWrap,{sliderId:viewer._viewerId,onStart:function(){if(!viewer.loaded)return false;var handleStyle=snapHandle[0].style;this.curHandleTop=parseFloat(handleStyle.top);this.curHandleLeft=parseFloat(handleStyle.left);this.handleWidth=parseFloat(handleStyle.width);this.handleHeight=parseFloat(handleStyle.height);this.width=
snapImgWrap.width();this.height=snapImgWrap.height();clearInterval(imageSlider.slideMomentumCheck);cancelAnimationFrame(imageSlider.sliderMomentumFrame)},onMove:function(e,position){var xPerc=this.curHandleLeft+position.dx*100/this.width,yPerc=this.curHandleTop+position.dy*100/this.height;xPerc=Math.max(0,xPerc);xPerc=Math.min(100-this.handleWidth,xPerc);yPerc=Math.max(0,yPerc);yPerc=Math.min(100-this.handleHeight,yPerc);var containerDim=viewer.containerDim,imgWidth=viewer.imageDim.w*(viewer.zoomValue/
100),imgHeight=viewer.imageDim.h*(viewer.zoomValue/100),imgLeft=imgWidth<containerDim.w?(containerDim.w-imgWidth)/2:-imgWidth*xPerc/100,imgTop=imgHeight<containerDim.h?(containerDim.h-imgHeight)/2:-imgHeight*yPerc/100;snapHandle.css({top:yPerc+"%",left:xPerc+"%"});viewer.currentImg.css({left:imgLeft,top:imgTop})}})).init();var imageSlider=viewer._imageSlider=(new Slider(imageWrap,{sliderId:viewer._viewerId,onStart:function(e,position){if(!viewer.loaded)return false;if(zooming)return;var self=this;
snapSlider.onStart();self.imgWidth=viewer.imageDim.w*viewer.zoomValue/100;self.imgHeight=viewer.imageDim.h*viewer.zoomValue/100;self.positions=[position,position];self.startPosition=position;viewer._clearFrames();self.slideMomentumCheck=setInterval(function(){if(!self.currentPos)return;self.positions.shift();self.positions.push({x:self.currentPos.mx,y:self.currentPos.my})},50)},onMove:function(e,position){if(zooming)return;this.currentPos=position;snapSlider.onMove(e,{dx:-position.dx*snapSlider.width/
this.imgWidth,dy:-position.dy*snapSlider.height/this.imgHeight})},onEnd:function(){if(zooming)return;var self=this;var xDiff=this.positions[1].x-this.positions[0].x,yDiff=this.positions[1].y-this.positions[0].y;function momentum(){if(step<=60)self.sliderMomentumFrame=requestAnimationFrame(momentum);positionX=positionX+easeOutQuart(step,xDiff/3,-xDiff/3,60);positionY=positionY+easeOutQuart(step,yDiff/3,-yDiff/3,60);snapSlider.onMove(null,{dx:-(positionX*snapSlider.width/self.imgWidth),dy:-(positionY*
snapSlider.height/self.imgHeight)});step++}if(Math.abs(xDiff)>30||Math.abs(yDiff)>30){var step=1,positionX=self.currentPos.dx,positionY=self.currentPos.dy;momentum()}}})).init();var changedDelta=0;imageWrap.on("mousewheel"+eventSuffix+" DOMMouseScroll"+eventSuffix,function(e){if(!options.zoomOnMouseWheel)return;if(!viewer.loaded)return;viewer._clearFrames();var delta=Math.max(-1,Math.min(1,e.originalEvent.wheelDelta||-e.originalEvent.detail)),zoomValue=viewer.zoomValue*(100+delta*ZOOM_CONSTANT)/100;
if(!(zoomValue>=100&&zoomValue<=options.maxZoom))changedDelta+=Math.abs(delta);else changedDelta=0;if(changedDelta>MOUSE_WHEEL_COUNT)return;e.preventDefault();var contOffset=container.offset(),x=(e.pageX||e.originalEvent.pageX)-contOffset.left,y=(e.pageY||e.originalEvent.pageY)-contOffset.top;viewer.zoom(zoomValue,{x:x,y:y});showSnapView()});if(options.pinchZoom)imageWrap.on("touchstart"+eventSuffix,function(estart){if(!viewer.loaded)return;var touch0=estart.originalEvent.touches[0],touch1=estart.originalEvent.touches[1];
if(!(touch0&&touch1))return;zooming=true;var contOffset=container.offset();var startdist=Math.sqrt(Math.pow(touch1.pageX-touch0.pageX,2)+Math.pow(touch1.pageY-touch0.pageY,2)),startZoom=viewer.zoomValue,center={x:(touch1.pageX+touch0.pageX)/2-contOffset.left,y:(touch1.pageY+touch0.pageY)/2-contOffset.top};var moveListener=function(emove){emove.preventDefault();var touch0=emove.originalEvent.touches[0],touch1=emove.originalEvent.touches[1],newDist=Math.sqrt(Math.pow(touch1.pageX-touch0.pageX,2)+Math.pow(touch1.pageY-
touch0.pageY,2)),zoomValue=startZoom+(newDist-startdist)/2;viewer.zoom(zoomValue,center)};var endListener=function(){$document.off("touchmove",moveListener);$document.off("touchend",endListener);zooming=false};$document.on("touchmove",moveListener);$document.on("touchend",endListener)});var touchtime=0,point;imageWrap.on("click"+eventSuffix,function(e){if(touchtime==0){touchtime=Date.now();point={x:e.pageX,y:e.pageY}}else if(Date.now()-touchtime<500&&(Math.abs(e.pageX-point.x)<50&&Math.abs(e.pageY-
point.y)<50)){if(viewer.zoomValue==options.zoomValue)viewer.zoom(200);else viewer.resetZoom();touchtime=0}else touchtime=0});var slider=viewer.snapView.find(".beemap-indoor-zoom-slider");var zoomSlider=(new Slider(slider,{sliderId:viewer._viewerId,onStart:function(eStart){if(!viewer.loaded)return false;this.leftOffset=slider.offset().left;this.handleWidth=viewer.zoomHandle.width();this.onMove(eStart)},onMove:function(e,position){var newLeft=(e.pageX||e.originalEvent.touches[0].pageX)-this.leftOffset-
this.handleWidth/2;newLeft=Math.max(0,newLeft);newLeft=Math.min(viewer._zoomSliderLength,newLeft);var zoomValue=100+(options.maxZoom-100)*newLeft/viewer._zoomSliderLength;viewer.zoom(zoomValue)}})).init();var snapViewTimeout,snapViewVisible;function showSnapView(noTimeout){if(!options.snapView)return;if(snapViewVisible||(viewer.zoomValue<=100||!viewer.loaded))return;clearTimeout(snapViewTimeout);snapViewVisible=true;viewer.snapView.css("opacity",1);if(!noTimeout)snapViewTimeout=setTimeout(function(){viewer.snapView.css("opacity",
0);snapViewVisible=false},4E3)}imageWrap.on("touchmove"+eventSuffix+" mousemove"+eventSuffix,function(){showSnapView()});var snapEventsCallback={};snapEventsCallback["mouseenter"+eventSuffix+" touchstart"+eventSuffix]=function(){snapViewVisible=false;showSnapView(true)};snapEventsCallback["mouseleave"+eventSuffix+" touchend"+eventSuffix]=function(){snapViewVisible=false;showSnapView()};viewer.snapView.on(snapEventsCallback);if(options.refreshOnResize)$window.on("resize"+eventSuffix,function(){viewer.refresh()});
if(options.zoomControler)viewer.initZoomControler(options.zoomControlerPosition)},initZoomControler:function(pos){pos=pos!="topleft"&&(pos!="topright"&&(pos!="bottomleft"&&pos!="bottomright"))?"topright":pos;var viewer=this;switch(pos){case "topleft":pos=viewer.controltl;break;case "topright":pos=viewer.controltr;break;case "bottomleft":pos=viewer.controlbl;break;case "bottomright":pos=viewer.controlbr;break}var markup=['\x3cdiv class\x3d"beemap-indoor-zoom-controler'+(viewer.zoomControlerCustomClass!=
""?" "+viewer.zoomControlerCustomClass:"")+'"\x3e','\t\x3cbutton class\x3d"beemap-indoor-zoom-controler-in"\x3e\uff0b\x3c/button\x3e','\t\x3cbutton class\x3d"beemap-indoor-zoom-controler-out"\x3e\uff0d\x3c/button\x3e',"\x3c/div\x3e"].join("");pos.append(markup);pos.find(".beemap-indoor-zoom-controler-in").click(function(){var zoomValue=viewer.zoomValue+100;viewer.zoom(zoomValue);return false});pos.find(".beemap-indoor-zoom-controler-out").click(function(){var zoomValue=viewer.zoomValue-100;viewer.zoom(zoomValue);
return false})},initFloorControler:function(pos){pos=pos!="topleft"&&(pos!="topright"&&(pos!="bottomleft"&&pos!="bottomright"))?"topright":pos;var viewer=this;if(!viewer.floor.length)return;switch(pos){case "topleft":pos=viewer.controltl;break;case "topright":pos=viewer.controltr;break;case "bottomleft":pos=viewer.controlbl;break;case "bottomright":pos=viewer.controlbr;break}if(pos.find(".beemap-indoor-floor-controler .floor-list").length)return;var markup='\x3cdiv class\x3d"beemap-indoor-floor-controler'+
(viewer.options.floorControlerCustomClass!=""?" "+viewer.options.floorControlerCustomClass:"")+'"\x3e\x3cul class\x3d"floor-list"\x3e\x3c/ul\x3e\x3c/div\x3e';pos.append(markup);var list=pos.find(".beemap-indoor-floor-controler .floor-list");for(var i=viewer.floor.length-1;i>=0;i--){var li=$("\x3cli /\x3e").attr("data-floor",viewer.floor[i].floor).append(viewer.floor[i].name).click(function(e){var floor=$(this).attr("data-floor");$(this).parent().find("li").css({backgroundColor:"#fff"});$(this).css({backgroundColor:"#eee"});
viewer.container.find(".beemap-indoor-large-image.activeTarget").attr("src",viewer.container.find('.beemap-indoor-floor-image[data-floor\x3d"'+floor+'"]').attr("src"));viewer.removeAllMarkers();if(!viewer.options.zoomAnimation)viewer._clearFrames();viewer.refresh();if(typeof viewer.options.onFloorChanged==="function")viewer.options.onFloorChanged.call(e,floor);return false});list.append(li)}if(viewer.defaultFloor!=undefined)list.find('li[data-floor\x3d"'+viewer.defaultFloor+'"]').css({backgroundColor:"#eee"});
else list.find("li:last-child").css({backgroundColor:"#eee"})},setView:function(zoomValue,point){var self=this,newPoint=self._pointToZoomPoint(point);self.zoom(zoomValue,newPoint)},zoom:function(perc,point){perc=Math.round(Math.max(100,perc));perc=Math.min(this.options.maxZoom,perc);point=point||{x:this.containerDim.w/2,y:this.containerDim.h/2};var self=this,maxZoom=self.options.maxZoom,zoomAni=self.options.zoomAnimation,curPerc=self.zoomValue,curImg=self.currentImg,containerDim=self.containerDim,
curLeft=parseFloat(curImg.css("left")),curTop=parseFloat(curImg.css("top"));self._clearFrames();var step=0;var imageDim=self.imageDim,baseLeft=(containerDim.w-imageDim.w)/2,baseTop=(containerDim.h-imageDim.h)/2,baseRight=containerDim.w-baseLeft,baseBottom=containerDim.h-baseTop;function zoom(){var tickZoom=0,limitStep=20;if(zoomAni){step++;if(step<limitStep)self._zoomFrame=requestAnimationFrame(zoom)}else{step=100,limitStep=100;if(step<limitStep)self._zoomFrame=requestAnimationFrame(zoom)}tickZoom=
easeOutQuart(step,curPerc,perc-curPerc,limitStep);var ratio=tickZoom/curPerc,imgWidth=self.imageDim.w*tickZoom/100,imgHeight=self.imageDim.h*tickZoom/100,newLeft=-((point.x-curLeft)*ratio-point.x),newTop=-((point.y-curTop)*ratio-point.y);newLeft=Math.min(newLeft,baseLeft);newTop=Math.min(newTop,baseTop);if(newLeft+imgWidth<baseRight)newLeft=baseRight-imgWidth;if(newTop+imgHeight<baseBottom)newTop=baseBottom-imgHeight;curImg.css({height:imgHeight+"px",width:imgWidth+"px",left:newLeft+"px",top:newTop+
"px"});self.zoomValue=tickZoom;self._resizeHandle(imgWidth,imgHeight,newLeft,newTop);self.zoomHandle.css("left",(tickZoom-100)*self._zoomSliderLength/(maxZoom-100)+"px");if(!zoomAni)self._clearFrames()}zoom()},_clearFrames:function(){clearInterval(this._imageSlider.slideMomentumCheck);cancelAnimationFrame(this._imageSlider.sliderMomentumFrame);cancelAnimationFrame(this._zoomFrame)},resetZoom:function(){this.zoom(this.options.zoomValue)},_calculateDimensions:function(){var self=this,curImg=self.currentImg,
container=self.container,snapView=self.snapView,imageWidth=curImg.width(),imageHeight=curImg.height(),contWidth=container.width(),contHeight=container.height(),snapViewWidth=snapView.innerWidth(),snapViewHeight=snapView.innerHeight();self.containerDim={w:contWidth,h:contHeight};var imgWidth,imgHeight,ratio=imageWidth/imageHeight;imgWidth=imageWidth>imageHeight&&contHeight>=contWidth||ratio*contHeight>contWidth?contWidth:ratio*contHeight;imgHeight=imgWidth/ratio;self.imageDim={w:imgWidth,h:imgHeight};
curImg.css({width:imgWidth+"px",height:imgHeight+"px",left:(contWidth-imgWidth)/2+"px",top:(contHeight-imgHeight)/2+"px","max-width":"none","max-height":"none"});var snapWidth=imgWidth>imgHeight?snapViewWidth:imgWidth*snapViewHeight/imgHeight,snapHeight=imgHeight>imgWidth?snapViewHeight:imgHeight*snapViewWidth/imgWidth;self.snapImageDim={w:snapWidth,h:snapHeight};self.snapImg.css({width:snapWidth,height:snapHeight});self._zoomSliderLength=snapViewWidth-self.zoomHandle.outerWidth()},refresh:function(){if(!this.loaded)return;
this._calculateDimensions();this.resetZoom()},_resizeHandle:function(imgWidth,imgHeight,imgLeft,imgTop){var curImg=this.currentImg,imageWidth=imgWidth||this.imageDim.w*this.zoomValue/100,imageHeight=imgHeight||this.imageDim.h*this.zoomValue/100,left=Math.max(-(imgLeft||parseFloat(curImg.css("left")))*100/imageWidth,0),top=Math.max(-(imgTop||parseFloat(curImg.css("top")))*100/imageHeight,0),handleWidth=Math.min(this.containerDim.w*100/imageWidth,100),handleHeight=Math.min(this.containerDim.h*100/imageHeight,
100);this.snapHandle.css({top:top+"%",left:left+"%",width:handleWidth+"%",height:handleHeight+"%"})},options:function(key,value){if(!value)return this.options[key];this.options[key]=value},destroy:function(key,value){var eventSuffix="."+this._viewerId;this.container.remove('[class^\x3d"beemap-indoor-"]');$window.off(eventSuffix);return null},load:function(resObj,callback){if(typeof resObj!=="object")return;var self=this,container=self.container;container.find(".beemap-indoor-snap-image,.beemap-indoor-large-image").remove();
var snapImageWrap=self.container.find(".beemap-indoor-snap-image-wrap");self.defaultFloor=resObj.defaultFloor;self.floor=resObj.floors;for(var i=0;i<self.floor.length;i++)if(self.floor[i].floor==self.defaultFloor){snapImageWrap.prepend('\x3cimg class\x3d"beemap-indoor-snap-image" src\x3d"'+self.floor[i].thumb+'" /\x3e');self.imageWrap.prepend('\x3cimg class\x3d"beemap-indoor-large-image" src\x3d"'+self.floor[i].thumb+'" /\x3e');self.imageWrap.append('\x3cimg class\x3d"beemap-indoor-large-image activeTarget" src\x3d"'+
self.floor[i].image+'" /\x3e')}for(i=0;i<self.floor.length;i++)self.imageWrap.prepend('\x3cimg class\x3d"beemap-indoor-floor-image" style\x3d"display: none;" data-floor\x3d"'+self.floor[i].floor+'" src\x3d"'+self.floor[i].image+'" /\x3e');self.imageWrap.append('\x3cdiv class\x3d"beemap-indoor-large-image"\x3e\x3cdiv class\x3d"beemap-indoor-marker-layer"\x3e\x3csvg xmlns\x3d"http://www.w3.org/2000/svg" class\x3d"beemap-indoor-draw-layer"\x3e\x3c/svg\x3e\x3c/div\x3e\x3c/div\x3e');var currentImg=self.currentImg=
container.find(".beemap-indoor-large-image");self.floorImg=container.find(".beemap-indoor-floor-image");self.snapImg=container.find(".beemap-indoor-snap-image");self.markerWrap=container.find(".beemap-indoor-marker-layer");self.drawWrap=container.find(".beemap-indoor-draw-layer");self.loaded=false;self._realWidth=0,self._realHeight=0;container.find(".beemap-indoor-loader").show();currentImg.hide();self.snapImg.hide();function refreshView(){self.loaded=true;self.zoomValue=100;currentImg.show();self.snapImg.show();
self.refresh();self.resetZoom();if(typeof currentImg[1].naturalWidth!=="undefined"&&currentImg[1].naturalWidth>self._realWidth){self._realWidth=currentImg[1].naturalWidth;self._realHeight=currentImg[1].naturalHeight}container.find(".beemap-indoor-loader").hide();if(self.options.floorControler)self.initFloorControler(self.options.floorControlerPosition);if(typeof callback==="function")callback.call()}$(currentImg[1]).on("load",refreshView)},point:function(x,y,round){var point={x:round?Math.round(x):
x,y:round?Math.round(y):y};return point},icon:function(options){var defIconSize=this.point(32,32);var iconPath=typeof options==="object"&&typeof options.path==="string"?options.path:"./_images/",iconImage=typeof options==="object"&&typeof options.image==="string"?options.image:"icon_marker.png",iconSize=typeof options==="object"&&typeof options.size==="object"?options.size:defIconSize,iconAnchor=typeof options==="object"&&typeof options.anchor==="object"?options.anchor:this.point(iconSize.x/2,iconSize.y-
2);var icon=$("\x3cimg /\x3e").attr("src",iconPath+iconImage).css({position:"absolute",width:iconSize.x+"px",height:iconSize.y+"px",marginLeft:"-"+iconAnchor.x+"px",marginTop:"-"+iconAnchor.y+"px"}).addClass("beemap-indoor-marker-icon");return icon},gmid:function(){return GMID_PREFIX+GMID++},_pointToPercentage:function(point){var self=this,realImageW=self._realWidth,realImageH=self._realHeight,newPercentX=point.x/realImageW*100,newPercentY=point.y/realImageH*100;return self.point(newPercentX,newPercentY)},
_pointToZoomPoint:function(point){if(typeof point!=="object")return;var self=this;var curZoom=self.zoomValue,imageDim=self.imageDim,curImg=self.currentImg,containerDim=self.containerDim,curLeft=parseFloat($(curImg[1]).css("left")),curTop=parseFloat($(curImg[1]).css("top")),percentage=self._pointToPercentage(point);var newPointX=(imageDim.w+curLeft*2)*curZoom/100*(percentage.x/100),newPointY=(imageDim.h+curTop*2)*curZoom/100*(percentage.y/100);return self.point(newPointX,newPointY)},setMarker:function(point,
options){if(typeof point==="undefined")return;var self=this;var defaults={id:self.gmid(),type:"both",icon:self.icon(),html:"",align:"center bottom",padding:5,point:point,className:""};options=$.extend({},defaults,options);var newPoint=self._pointToPercentage(point);var htmlBox=$("\x3cdiv /\x3e").addClass("beemap-indoor-marker-html").append(options.html).css({position:"absolute",whiteSpace:"nowrap",display:"none"});var marker=$("\x3cdiv /\x3e").addClass("beemap-indoor-marker"+(options.className?" "+
options.className:"")).attr("data-id",options.id).append(options.type!="html"?options.icon:"").append(htmlBox);if(typeof options.mouseover==="function"){$(options.icon[0]).on("mouseenter",function(e){options.mouseover.call(e,options);return false});if(options.type!="both")htmlBox.on("mouseenter",function(e){options.mouseover.call(e,options);return false})}if(typeof options.mouseout==="function"){$(options.icon[0]).on("mouseleave",function(e){options.mouseout.call(e,options);return false});if(options.type!=
"both")htmlBox.on("mouseleave",function(e){options.mouseout.call(e,options);return false})}if(typeof options.click==="function"){$(options.icon[0]).on("click",function(e){options.click.call(e,options);return false});if(options.type!="both")htmlBox.on("click",function(e){options.click.call(e,options);return false})}self.markerWrap.append(marker);marker.css({left:newPoint.x+"%",top:newPoint.y+"%"});var htmlObj=self.markerWrap.find(".beemap-indoor-marker[data-id\x3d"+options.id+"] .beemap-indoor-marker-html"),
htmlWidth=parseFloat(htmlObj.width()),htmlHeight=parseFloat(htmlObj.height());if(options.type!="icon"){var aligns=options.align.indexOf(" ")!=-1?options.align.split(" "):options.align+" middle",x=0,y=0;switch(aligns[0]){case "left":x=-htmlWidth;break;case "right":x=0;break;default:x=-(htmlWidth/2)}switch(aligns[1]){case "top":y=options.type=="both"?-(options.icon[0].clientHeight+htmlHeight+options.padding):-(htmlHeight+options.padding);break;case "middle":y=options.type=="both"?options.padding:-(htmlHeight/
2);break;default:y=options.padding}htmlObj.css({marginLeft:x+"px",marginTop:y+"px"}).show()}return options},setPolyline:function(points,options){var self=this,svg=self.drawWrap;if(Object.prototype.toString.call(points)!=="[object Array]")return;var defaults={id:self.gmid(),width:2,color:"#f00",linecap:"round"};options=$.extend({},defaults,options);var g=document.createElementNS("http://www.w3.org/2000/svg","g"),g=$(g);g.attr("data-id",options.id).css({"stroke":options.color,"stroke-width":options.width,
"stroke-linecap":options.linecap});if(typeof options.mouseover==="function")g.on("mouseenter",function(e){options.mouseover.call(e,options);return false});if(typeof options.mouseout==="function")g.on("mouseleave",function(e){options.mouseout.call(e,options);return false});if(typeof options.click==="function")g.on("click",function(e){options.click.call(e,options);return false});svg.append(g);var line=null,point1=null,point2=null;for(var i=0;i<points.length;i++){point1=self._pointToPercentage(points[i]);
if(typeof points[i+1]!=="undefined"){point2=self._pointToPercentage(points[i+1]);line=document.createElementNS("http://www.w3.org/2000/svg","line"),line=$(line),line.attr({x1:point1.x+"%",y1:point1.y+"%",x2:point2.x+"%",y2:point2.y+"%"});g.append(line)}}return g},removeMarker:function(obj){if(typeof obj==="undefined")return;this.markerWrap.find(".beemap-indoor-marker[data-id\x3d"+obj.id+"]").remove()},removeAllMarkers:function(){this.markerWrap.find(".beemap-indoor-marker").remove()},removePolyline:function(obj){if(typeof obj===
"undefined")return;this.drawWrap.find("g[data-id\x3d"+obj.id+"]").remove()},removeAllPolylines:function(obj){this.drawWrap.find("g").remove()}};ImageViewer.defaults={zoomValue:100,zoomAnimation:true,pinchZoom:true,zoomControler:true,zoomControlerCustomClass:"",zoomControlerPosition:"topright",floorControler:false,floorControlerCustomClass:"",floorControlerPosition:"bottomright",snapView:false,maxZoom:500,refreshOnResize:true,zoomOnMouseWheel:true};window.ImageViewer=function(container,options){var imgElm,
imgSrc,hiResImg;if(!(container&&(typeof container=="string"||(container instanceof Element||container[0]instanceof Element)))){options=container;container=$("#beemap-indoor-container")}container=$(container);if(container.is("img")){imgElm=container;imgSrc=imgElm[0].src;hiResImg=imgElm.attr("high-res-src")||imgElm.attr("data-high-res-src");container=imgElm.wrap('\x3cdiv class\x3d"beemap-indoor-container" style\x3d"display:inline-block; overflow:hidden"\x3e\x3c/div\x3e').parent();imgElm.css({opacity:0,
position:"relative",zIndex:-1})}else{imgSrc=container.attr("src")||container.attr("data-src");hiResImg=container.attr("high-res-src")||container.attr("data-high-res-src")}var viewer=new ImageViewer(container,options);viewer._init();if(imgSrc)viewer.load(imgSrc,hiResImg);return viewer};$.fn.ImageViewer=function(options){return this.each(function(){var $this=$(this);var viewer=window.ImageViewer($this,options);$this.data("ImageViewer",viewer)})}})(window.jQuery,window,document);